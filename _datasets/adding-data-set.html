---
title: "Adding a Data Set to <code>pods</code>"
edit_url: https://github.com/lawrennd/talks/edit/gh-pages/_datasets/adding-data-set.md
date: 2014-05-28
published: 2014-05-28
week: 0
ipynb: adding-data-set.ipynb
edit_url: https://github.com/lawrennd/talks/edit/gh-pages/_datasets/adding-data-set.md
layout: dataset
categories:
- notes
---



<!-- Do not edit this file locally. -->
<!---->
<!-- Do not edit this file locally. -->
<!-- Do not edit this file locally. -->
<!-- The last names to be defined. Should be defined entirely in terms of macros from above-->
<!--

-->
<p>Adding a data set to GPy should be done in two stages. Firstly, you need to edit the <code>data_resources.json</code> file to provide information about where to download the data from and what the license and citation information for the data is. Then you can edit the <code>datasets.py</code> file, located in <code>GPy.util</code> to load in the data and perform any preprocessing, before returning the data set to the user in the standard dictionary format.</p>
<h2 id="step-1-editing-data_resources.json">Step 1: Editing <code>data_resources.json</code></h2>
<p>A <code>json</code> file is a simple way of storing a python dictionary in a format that is interchangeable with other languages. This file is loaded in at the beginning of <code>datasets.py</code> to provide information on where he data set is located, what its licensing terms are and any other standard details about the data. You can use any <code>json</code> editor to edit the file. You can also use a standard text editor, but be careful not to damage the format of the file! If you do damage the format, there are various on line json format checkers you can use to try and recover the file.</p>
<p>The file consists of a comma separated list of dictionary entries. Each dictionary entry corresponds to a single data set. Below is the dictionary entry for the Boston Housing data.</p>
<pre><code>&quot;boston_housing&quot;: {
    &quot;citation&quot;: &quot;Harrison, D. and Rubinfeld, D.L. &#39;Hedonic prices and the demand for clean air&#39;, J. Environ. Economics &amp; Management, vol.5, 81-102, 1978.&quot;,
    &quot;details&quot;: &quot;The Boston Housing data relates house values in Boston to a range of input variables.&quot;,
    &quot;files&quot;: [
        [
            &quot;Index&quot;,
            &quot;housing.data&quot;,
            &quot;housing.names&quot;
        ]
    ],
    &quot;license&quot;: null,
    &quot;size&quot;: 51276,
    &quot;urls&quot;: [
        &quot;http://archive.ics.uci.edu/ml/machine-learning-databases/housing/&quot;
    ]
},</code></pre>
<p>The entry includes firstly, the data set name. Then it includes six fields for describing. * <code>url</code> The download url location of the data. This is provided as a <em>list</em> of urls. Just in case several different locations need to be visited. Here the list contains only one element. * <code>files</code> This is a <em>list of lists</em>. Each list contains the files to be downloaded from the corresponding url. Here there are three files required from the first (and only) url. * <code>details</code> Some helpful information for the user about the data. * <code>citation</code> The citation to use when publishing on the data. If you use a data set you should always cite its origin. * <code>size</code> A total size information for the user to know how much disk space the data will take when its all downloaded. * <code>license</code> The license terms for the data. Many data sets have a license associated. Don’t include data sets in this collection that don’t permit their inclusion. There don’t appear to be any license constraints for the use of the Boston housing data, so in this case this vealue is set to <code>null</code>.</p>
<h2 id="step-2-including-the-data-in-datasets.py">Step 2: Including the Data in <code>datasets.py</code></h2>
<p>The <code>data_resources.json</code> file includes all the information about how to download the data. Now in <code>datasets.py</code> we write a short dataset recovery function to execute the download and return the data to the user. It has the following form:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> boston_housing(data_set<span class="op">=</span><span class="st">&#39;boston_housing&#39;</span>):</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> data_available(data_set):</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>        download_data(data_set)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    all_data <span class="op">=</span> np.genfromtxt(os.path.join(data_path, data_set, <span class="st">&#39;housing.data&#39;</span>))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> all_data[:, <span class="dv">0</span>:<span class="dv">13</span>]</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    Y <span class="op">=</span> all_data[:, <span class="dv">13</span>:<span class="dv">14</span>]</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data_details_return({<span class="st">&#39;X&#39;</span> : X, <span class="st">&#39;Y&#39;</span>: Y}, data_set)</span></code></pre></div>
<p>The function name allows users to call <code>data = pods.datasets.boston_housing()</code> to acquire the data. You should use a name that makes it clear to readers of the code what is going on. The data set name is passed to the function as a default argument. This name corresponds to the entry in the <code>json</code> file.</p>
<p>The next two lines call the function <code>data_available()</code> to check if the data set is already in the cache. If the data set is not there, then <code>download_data()</code>, which handles the interface with the user for downloading the data is called.</p>
<p>The location of the cached data can be determined through the configuration file. By default it is set to be in a temporary directory under your home directory: <code>tmp/GPy-datasets</code>. But you can change this by creating your own configuration file in your home directiory, <code>.gpy_user.cfg</code> or by editing the configuration file for your GPy installation, <code>installation.cfg</code>. See <a href="../pods/config.ipynb">this notebook</a> for details on the config file.</p>
<p>The final line, <code>data_details_return</code> returns the dictionary of information loaded in from <code>data_resource.json</code> alongside the dictionary we’ve just constructed. The dictionary we return to the user is in a standard format with entries <code>X</code> and <code>Y</code> for the covariates and response variables.</p>
<p>Now things should be ready for you to download the data!</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pods</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pods.datasets.boston_housing()</span></code></pre></div>
<h2 id="optional-step-3-preprocessing">Optional Step 3: Preprocessing</h2>
<p>In the above we haven’t performed any preprocessing of the data. What if we want to preprocess the data before giving it to the user? We can write a different, additional, version of the data set recovery function for providing a different preprocessing. Here we preprocess the <code>Y</code> values to be zero mean and unit standard deviation.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pods.datasets <span class="im">import</span> <span class="op">*</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> boston_housing_preprocess(data_set<span class="op">=</span><span class="st">&#39;boston_housing&#39;</span>):</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> data_available(data_set):</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        download_data(data_set)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    all_data <span class="op">=</span> np.genfromtxt(os.path.join(data_path, data_set, <span class="st">&#39;housing.data&#39;</span>))</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> all_data[:, <span class="dv">0</span>:<span class="dv">13</span>]</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    Y <span class="op">=</span> all_data[:, <span class="dv">13</span>:<span class="dv">14</span>]</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    Y <span class="op">=</span> (Y <span class="op">-</span> np.mean(Y))<span class="op">/</span>np.std(Y)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data_details_return({<span class="st">&#39;X&#39;</span> : X, <span class="st">&#39;Y&#39;</span>: Y, </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>                                <span class="st">&#39;info&#39;</span> : <span class="st">&#39;The response variables have been preprocessed to have zero mean and unit standard deviation&#39;</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>                                }, data_set)</span></code></pre></div>
<p>Now we can access the same data set, but this time, because we have the data in cache no download is performed.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> boston_housing_preprocess()</span></code></pre></div>
<p>For this version of the data set we can check that the response variables have been normalized.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Mean: &#39;</span>, data[<span class="st">&#39;Y&#39;</span>].mean())</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Standard deviation &#39;</span>, data[<span class="st">&#39;Y&#39;</span>].std())</span></code></pre></div>
<h1 id="references">References</h1>

